# Домашнее задание 2. Примитивная база данных

Это учебный консольный проект на **Python**, который имитирует работу примитивной базы данных.
С помощью программы можно:
1. создавать таблицы,
2. смотреть список таблиц,
3. удалять таблицы.

Структура таблиц (метаданные) сохраняется в **JSON-файл**, соответственно, состояние сохраняется между запусками.


## Возможности

1. Создание таблицы с набором столбцов и типами данных.
2. Автоматическое добавление столбца `ID:int` (уникальный ключ).
3. Просмотр списка всех таблиц.
4. Удаление таблицы.
5. Справка (`help`) и выход (`exit`).

Поддерживаемые типы данных: `int`, `str`, `bool`.


## Структура проекта

Основной код находится в папке `src/primitive_db`:
1. `main.py` — точка входа (запускает приложение).
2. `engine.py` — основной цикл программы и обработка команд пользователя.
3. `core.py` — логика работы с таблицами (create/drop/list).
4. `utils.py` — загрузка/сохранение метаданных в JSON

Метаданные хранятся в файле: `db_meta.json`.


## Используемые технологии

1. Python 3.12+
2. Poetry (управление зависимостями и запуск)
3. prompt (удобный ввод в консоли)
4. shlex (надёжный разбор командной строки)


## Установка и запуск

Установка зависимостей:

```bash
poetry install
```

Запуск приложения:

```bash
poetry run database
```

Запуск после установки пакета (как команды в терминале):

```bash
database
```


## Команды

1. `create_table <имя_таблицы> <столбец1:тип> <столбец2:тип> ...` — создать таблицу.
2. `list_tables` — показать список всех таблиц.
3. `drop_table <имя_таблицы>` — удалить таблицу.
4. `help` — вывести справку.
5. `exit` — выйти из программы


## CRUD-операции (работа с данными таблиц)

Данные таблиц сохраняются в файлы `data/<table_name>.json`.  
Папка `data/` используется для хранения данных между запусками.

### Команды

1. `insert into <table> values (<v1>, <v2>, ...)` — добавить запись в таблицу
Строковые значения вводятся в двойных кавычках `"..."`, например: `insert into users values ("Sergei", 28, true)`.
2. `select from <table>` — вывести все записи таблицы.
3. `select from <table> where <col> = <value>` — вывести записи по условию. Например: `select from users where age = 28`
4. `update <table> set <col> = <value> where <col> = <value>` — обновить записи по условию.
5. `delete from <table> where <col> = <value>` — удалить записи по условию.
6. `info <table>` — вывести информацию о таблице (столбцы и количество записей).

## Декораторы и замыкания

В проекте реализованы декораторы и замыкания для улучшения читаемости и надёжности кода:

- Операции с таблицами теперь перехватывают частые ошибки (например, отсутствующая таблица/файл, неверные значения) и выводят понятные сообщения без падения программы.
- Перед удалением записи или таблицы пользователь должен подтвердить действие (`y/n`). При отказе операция отменяется.
- Для "медленных" операций выводится время выполнения (например, `select`).
- Повторяющиеся запросы `select ... where ...` могут возвращаться из кэша (кэш автоматически сбрасывается после изменений данных: `insert/update/delete/create_table/drop_table`).


## Пример сценария работы

```text
>>>Введите команду: create_table users name:str age:int is_active:bool
Таблица "users" успешно создана со столбцами: ID:int, name:str, age:int, is_active:bool

>>>Введите команду: insert into users values ("Sergei", 28, true)
Запись с ID=1 успешно добавлена в таблицу "users".

>>>Введите команду: insert into users values ("Anna", 20, false)
Запись с ID=2 успешно добавлена в таблицу "users".

>>>Введите команду: select from users
+----+--------+-----+-----------+
| ID |  name  | age | is_active |
+----+--------+-----+-----------+
| 1  | Sergei |  28 |   True    |
| 2  |  Anna  |  20 |   False   |
+----+--------+-----+-----------+

>>>Введите команду: select from users where age = 28
+----+--------+-----+-----------+
| ID |  name  | age | is_active |
+----+--------+-----+-----------+
| 1  | Sergei |  28 |   True    |
+----+--------+-----+-----------+

>>>Введите команду: update users set age = 29 where name = "Sergei"
Запись с ID=1 в таблице "users" успешно обновлена.

>>>Введите команду: delete from users where age = 20
Запись с ID=2 успешно удалена из таблицы "users".

>>>Введите команду: info users
Таблица: users
Столбцы: ID:int, name:str, age:int, is_active:bool
Количество записей: 1

>>>Введите команду: exit
```


## Демо (asciinema)

Запись демонстрации работы программы (CRUD-операции, обработка ошибок, подтверждение действий): https://asciinema.org/a/4DdjL7Ix3K6H2pr2

В записи показано:
1. Создание таблицы и добавление записей.
2. Выборка `select` и выборка с условием `where`.
3. Обновление записи `update`.
4. Удаление с подтверждением (`delete`, `drop_table`).
5. Пример обработки ошибки при некорректной команде или типе.
